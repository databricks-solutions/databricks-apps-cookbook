---
sidebar_position: 3
---

# Connect an MCP server

This recipe connects to an [MCP](https://modelcontextprotocol.io/overview) server for AI applications using GitHub as an example and Unity Catalog [HTTP connections](https://docs.databricks.com/aws/en/query-federation/http) for secure and governed access.

## Code snippets

### OAuth User to Machine Per User (On-behalf-of-user)

```python title="app.py"

import reflex as rx
from databricks.sdk import WorkspaceClient
from databricks.sdk.service.serving import ExternalFunctionRequestHttpMethod
import json

class State(rx.State):
    """State stores the last MCP response as a JSON string."""
    response: str = ""
    connection_name: str = "github_u2m_connection"

    def run_mcp_list(self):
        """Initialize an MCP session, then call tools/list and store the JSON result."""
        # WorkspaceClient() will use the app's service principal or per-user context.
        w = WorkspaceClient()

        init_payload = {
            "jsonrpc": "2.0",
            "id": "init-1",
            "method": "initialize",
            "params": {}
        }
        init_resp = w.serving_endpoints.http_request(
            conn=self.connection_name,
            method=ExternalFunctionRequestHttpMethod.POST,
            path="/",
            json=init_payload,
        )
        session_id = init_resp.headers.get("mcp-session-id")

        headers = {"Content-Type": "application/json"}
        if session_id:
            headers["Mcp-Session-Id"] = session_id

        payload = {"jsonrpc": "2.0", "id": "list-1", "method": "tools/list"}

        resp = w.serving_endpoints.http_request(
            conn=self.connection_name,
            method=ExternalFunctionRequestHttpMethod.POST,
            path="/",
            headers=headers,
            json=payload,
        )

        try:
            self.response = json.dumps(resp.json(), indent=2)
        except Exception:
            # Fallback to raw text if JSON parsing fails
            self.response = resp.text or ""

def index() -> rx.Component:
    return rx.vstack(
        rx.heading("Connect an MCP server (Reflex)"),
        rx.button("Run", on_click=State.run_mcp_list),
        rx.box(rx.text(State.response), padding="4", width="100%", white_space="pre"),
        spacing="4",
        padding="4"
    )

app = rx.App()
app.add_page(index)
```

### Bearer token

```python title="app.py"
# Reflex (Databricks) version for a simple GET using a bearer/token-auth HTTP connection.
import reflex_enterprise as rx
from databricks.sdk import WorkspaceClient
from databricks.sdk.service.serving import ExternalFunctionRequestHttpMethod
import json

class State(rx.State):
    response: str = ""
    connection_name: str = "github_u2m_connection"

    def fetch_traffic_views(self):
        w = WorkspaceClient()
        resp = w.serving_endpoints.http_request(
            conn=self.connection_name,
            method=ExternalFunctionRequestHttpMethod.GET,
            path="/traffic/views",
            headers={"Accept": "application/vnd.github+json"},
        )
        try:
            self.response = json.dumps(resp.json(), indent=2)
        except Exception:
            self.response = resp.text or ""

def index() -> rx.Component:
    return rx.vstack(
        rx.heading("Fetch Traffic Views (Reflex)"),
        rx.button("Fetch Views", on_click=State.fetch_traffic_views),
        rx.box(rx.text(State.response), padding="4", width="100%", white_space="pre"),
        spacing="4"
    )

app = rx.App()
app.add_page(index)
```

## Resources

- [Unity Catalog HTTP Connection](https://docs.databricks.com/aws/en/query-federation/http) with the MCP (/mcp) base path

## Permissions

Your [app service principal](https://docs.databricks.com/aws/en/dev-tools/databricks-apps/#how-does-databricks-apps-manage-authorization) needs the following permissions:

- `USE CONNECTION` permission on the HTTP Connection

When using OAuth User to Machine Per User (On-behalf-of-user), you need to configure [User authorization](https://docs.databricks.com/aws/en/dev-tools/databricks-apps/auth#user-authorization) by adding the Unity Catalog connection or other scopes.

## Dependencies

- [Databricks SDK for Python](https://pypi.org/project/databricks-sdk/) - `databricks-sdk`
- [Reflex Enterprise for Databricks](https://pypi.org/project/reflex-enterprise/) - `reflex_enterprise`
- [MCP CLI](https://pypi.org/project/mcp/) - `mcp[cli]`

```python title="requirements.txt"
databricks-sdk
reflex-enterprise
mcp[cli]
```
